# Deployment Guide for Semimassive Site

This guide covers deploying the Semimassive marketing site to Vercel with custom domain, ISR caching, and production optimizations.

## Prerequisites

- GitHub account with repository connected
- Vercel account (free tier works)
- Domain name (e.g., semimassive.com) - optional but recommended
- Node.js 20+ and pnpm installed locally

## Pre-Deployment Checklist

Before deploying, ensure your build is production-ready:

```bash
# Navigate to project directory
cd semimassive-site

# Run all quality checks
pnpm typecheck    # TypeScript validation
pnpm lint         # ESLint checks
pnpm build        # Production build
pnpm test         # Test suite
```

All commands should pass with no errors.

## Step 1: Install Vercel CLI

```bash
# Install Vercel CLI globally (one-time)
pnpm dlx vercel@latest

# Or install globally
pnpm add -g vercel
```

## Step 2: Link Project to Vercel

```bash
# Navigate to your project
cd semimassive-site

# Login to Vercel (opens browser)
vercel login

# Link project (creates .vercel directory)
vercel link
```

When prompted:
- **Set up and deploy?** → Yes
- **Which scope?** → Choose your Vercel account/team
- **Link to existing project?** → No (first time) or Yes (if project exists)
- **Project name?** → `semimassive-site` (or your preferred name)
- **Directory?** → `./` (current directory)
- **Override settings?** → No

This creates `.vercel` directory with project metadata (add to `.gitignore`).

## Step 3: Configure Environment Variables

### In Vercel Dashboard

1. Go to [https://vercel.com/dashboard](https://vercel.com/dashboard)
2. Select your project → **Settings** → **Environment Variables**
3. Add the following variables for **Production** and **Preview** environments:

#### Required Variables

| Variable | Value | Environments |
|----------|-------|--------------|
| `NEXT_PUBLIC_SITE_URL` | `https://semimassive.com` | Production |
| `NEXT_PUBLIC_SITE_URL` | `https://preview-*.vercel.app` | Preview |

#### Optional Variables

| Variable | Value | Environments |
|----------|-------|--------------|
| `NEXT_PUBLIC_PLAUSIBLE_DOMAIN` | `semimassive.com` | Production |

**Note:** Preview URLs are auto-generated by Vercel. You can use the deployment URL or leave blank for preview environments.

### Local Development

Create `.env.local` (not committed to git):

```bash
NEXT_PUBLIC_SITE_URL=http://localhost:3000
# NEXT_PUBLIC_PLAUSIBLE_DOMAIN=semimassive.com  # Optional for local testing
```

## Step 4: Deploy to Preview

Test your deployment with a preview first:

```bash
# Deploy to preview environment
vercel

# Or specify preview explicitly
vercel --env preview
```

This creates a preview URL like: `https://semimassive-site-abc123.vercel.app`

### Test Preview Deployment

1. Visit the preview URL
2. Check all pages load correctly
3. Verify OG images: `https://your-preview-url.vercel.app/api/og?title=Test&subtitle=Preview`
4. Confirm robots.txt shows `Disallow: /` (preview should not be indexed)
5. Test CTA click tracking in browser console (if Plausible enabled)

## Step 5: Custom Domain Setup

### Add Domain in Vercel

1. Go to project → **Settings** → **Domains**
2. Click **Add Domain**
3. Enter your domain: `semimassive.com`
4. Click **Add** and follow verification steps

### DNS Configuration

#### Option A: Using Vercel Nameservers (Recommended)

If you purchased your domain through a registrar (GoDaddy, Namecheap, etc.):

1. Vercel provides nameservers: `ns1.vercel-dns.com`, `ns2.vercel-dns.com`
2. In your registrar's dashboard, update nameservers to Vercel's
3. Wait for DNS propagation (can take 24-48 hours)

#### Option B: Using A/AAAA Records

Add these DNS records in your registrar:

```
Type    Name    Value
A       @       76.76.21.21
AAAA    @       2606:4700:10::6816:1515
```

#### Option C: Using CNAME (for www subdomain)

```
Type    Name    Value
CNAME   www     cname.vercel-dns.com
```

### Set Primary Domain

1. In Vercel Domains settings, set `semimassive.com` as primary
2. Add redirect from `www.semimassive.com` → `semimassive.com` (or vice versa)
3. Vercel automatically handles HTTPS certificates via Let's Encrypt

### Update Environment Variables

After domain is verified, update `NEXT_PUBLIC_SITE_URL`:

```bash
# Production environment
NEXT_PUBLIC_SITE_URL=https://semimassive.com
```

## Step 6: Deploy to Production

Once domain is configured and preview tested:

```bash
# Deploy to production
vercel --prod
```

This triggers a production deployment to your custom domain.

## Step 7: Post-Deployment Verification

### Essential Checks

```bash
# 1. Verify site loads
curl -I https://semimassive.com

# 2. Check sitemap
curl https://semimassive.com/sitemap.xml

# 3. Check robots.txt
curl https://semimassive.com/robots.txt
```

### Manual Verification Checklist

- [ ] **Homepage** loads correctly at `https://semimassive.com`
- [ ] **Work page** shows all case studies at `/work`
- [ ] **Case studies** load at `/work/[slug]`
- [ ] **404 page** renders for invalid URLs (e.g., `/nonexistent`)
- [ ] **Breadcrumbs** appear on case study pages
- [ ] **Skip to content** link works (Tab key from top of page)
- [ ] **Navigation** active states work correctly
- [ ] **Contact link** opens email client
- [ ] **Canonical URLs** reference production domain

### SEO & Social Validation

Test your Open Graph images and meta tags:

1. **Twitter Card Validator:** [https://cards-dev.twitter.com/validator](https://cards-dev.twitter.com/validator)
2. **Facebook Debugger:** [https://developers.facebook.com/tools/debug/](https://developers.facebook.com/tools/debug/)
3. **LinkedIn Post Inspector:** [https://www.linkedin.com/post-inspector/](https://www.linkedin.com/post-inspector/)

Enter: `https://semimassive.com/work/xdefiant-onboarding`

Verify:
- [ ] OG image displays correctly
- [ ] Title and description are accurate
- [ ] No errors in meta tags

### Lighthouse Performance Audit

Run Lighthouse in Chrome DevTools (Incognito mode):

```
Target Scores:
- Performance:      ≥ 90
- Accessibility:    ≥ 95
- Best Practices:   ≥ 95
- SEO:              ≥ 95
```

### Analytics Verification (if Plausible enabled)

1. Visit your site with Plausible configured
2. Open browser console
3. Click a CTA button
4. Verify "CTA Click" event fires
5. Check Plausible dashboard for pageview events

## ISR & Caching Strategy

### How ISR Works

The site uses Incremental Static Regeneration (ISR) for case study pages:

```typescript
// In app/work/[slug]/page.tsx
export const revalidate = 86400; // 24 hours
```

**Behavior:**
- Pages are pre-built at deploy time
- Cached for 24 hours
- After 24h, first request triggers background regeneration
- Users see stale cache while fresh version generates
- Subsequent requests get updated version

### Force Fresh Content

To update content immediately without waiting for revalidation:

```bash
# Option 1: Edit MDX file and commit
git add content/work/my-case-study.mdx
git commit -m "Update case study content"
git push

# Vercel automatically rebuilds on push to main branch

# Option 2: Manual redeploy via Vercel dashboard
# Project → Deployments → Redeploy
```

### Static Asset Caching

Images, fonts, and media files are cached for 1 year:

```json
// vercel.json
"Cache-Control": "public, max-age=31536000, immutable"
```

This is optimal because:
- Next.js automatically fingerprints assets with content hashes
- Cache busts automatically when content changes
- Reduces bandwidth and improves performance

## Continuous Deployment

Vercel automatically deploys when you push to GitHub:

```bash
# Development workflow
git checkout -b feature/new-case-study
git add .
git commit -m "Add new case study"
git push origin feature/new-case-study

# Create PR on GitHub → Vercel creates preview deployment
# Merge to main → Vercel deploys to production
```

### Branch Deployments

- **`main` branch** → Production deployment
- **Other branches** → Preview deployments
- **Pull Requests** → Automatic preview with comment on PR

## Redirects

The site includes automatic redirects configured in `next.config.ts`:

```typescript
{
  source: '/index',
  destination: '/',
  permanent: true, // 301 redirect
}
```

### Adding New Redirects

Edit `next.config.ts`:

```typescript
async redirects() {
  return [
    // Example: Migrating old URLs
    {
      source: '/project/:slug',
      destination: '/work/:slug',
      permanent: true,
    },
    // Example: Old blog to new work
    {
      source: '/blog/:year/:month/:slug',
      destination: '/work/:slug',
      permanent: true,
    },
  ];
}
```

## Rollback Strategy

If a deployment breaks production:

### Option 1: Instant Rollback (Vercel Dashboard)

1. Go to project → **Deployments**
2. Find previous working deployment
3. Click **⋯** → **Promote to Production**
4. Deployment rolls back in ~30 seconds

### Option 2: Revert Git Commit

```bash
git revert HEAD
git push origin main
# Vercel auto-deploys the reverted version
```

## Monitoring & Debugging

### View Deployment Logs

```bash
# View recent deployments
vercel ls

# View logs for specific deployment
vercel logs [deployment-url]
```

### Function Logs (for API routes)

Access real-time function logs:
1. Vercel Dashboard → Project → **Logs**
2. Filter by function: `/api/og`

### Error Tracking

Next.js automatically captures errors. View in:
- Vercel Dashboard → **Analytics** → **Errors**
- Or integrate Sentry for advanced error tracking

## Environment-Specific Behavior

### Preview Deployments

- Robots: `User-agent: * / Disallow: /` (not indexed)
- Analytics: Disabled (or separate domain)
- URL: `https://[project]-[hash]-[scope].vercel.app`

### Production Deployment

- Robots: Allow indexing
- Analytics: Enabled
- URL: `https://semimassive.com`

## Performance Optimization

### Automatic Optimizations

Vercel automatically provides:
- Global CDN edge caching
- HTTP/2 and HTTP/3
- Brotli compression
- Automatic HTTPS
- DDoS protection

### Manual Optimizations

Already configured in the project:

- ✅ Image optimization (AVIF/WebP)
- ✅ Font preloading (Inter for headings)
- ✅ Static asset caching (1 year)
- ✅ ISR for dynamic content (24h)
- ✅ Next.js automatic code splitting

### Priority Images

Hero images use `priority` prop for faster LCP:

```tsx
<Figure
  src="/work/project/hero.jpg"
  alt="Hero image"
  priority  // Preloads above-the-fold
/>
```

## Troubleshooting

### Build Failures

**Issue:** Build fails with TypeScript errors

```bash
# Locally check types
pnpm typecheck

# Fix errors and commit
git add .
git commit -m "Fix type errors"
git push
```

**Issue:** Build fails with missing environment variables

- Verify variables are set in Vercel Dashboard
- Check variable names match exactly (case-sensitive)

### Domain Not Working

**Issue:** Domain shows "Domain not found"

1. Verify DNS records are correct
2. Wait for DNS propagation (24-48 hours)
3. Check domain status in Vercel Dashboard

**Issue:** HTTPS certificate error

- Vercel auto-provisions certificates, wait 5-10 minutes
- Ensure domain is verified in Vercel

### ISR Not Working

**Issue:** Content not updating after 24 hours

```bash
# Force redeploy
vercel --prod

# Or check revalidate export in page
export const revalidate = 86400;
```

### Analytics Not Tracking

**Issue:** Plausible events not firing

1. Check `NEXT_PUBLIC_PLAUSIBLE_DOMAIN` is set
2. Verify Plausible script loads (browser DevTools → Network)
3. Ensure production environment (doesn't load in development)

## CLI Command Reference

```bash
# Installation
pnpm dlx vercel@latest           # Install Vercel CLI

# Authentication
vercel login                     # Login to Vercel
vercel logout                    # Logout from Vercel

# Project Management
vercel link                      # Link local project to Vercel
vercel pull                      # Pull environment variables locally

# Deployment
vercel                           # Deploy to preview
vercel --prod                    # Deploy to production
vercel --env production          # Deploy to production (explicit)

# Information
vercel ls                        # List recent deployments
vercel logs [url]                # View deployment logs
vercel domains                   # List project domains
vercel env ls                    # List environment variables

# Domain Management
vercel domains add example.com   # Add domain
vercel domains rm example.com    # Remove domain

# Environment Variables
vercel env add                   # Add environment variable
vercel env rm VAR_NAME           # Remove environment variable
```

## Additional Resources

- [Next.js Deployment Docs](https://nextjs.org/docs/app/building-your-application/deploying)
- [Vercel Documentation](https://vercel.com/docs)
- [ISR Documentation](https://nextjs.org/docs/app/building-your-application/data-fetching/incremental-static-regeneration)
- [Vercel CLI Reference](https://vercel.com/docs/cli)
- [Custom Domain Setup](https://vercel.com/docs/projects/domains)

## Support

For issues with:
- **Vercel Platform:** [support@vercel.com](mailto:support@vercel.com)
- **Next.js Framework:** [GitHub Discussions](https://github.com/vercel/next.js/discussions)
- **This Project:** Check `README.md` or create GitHub issue
